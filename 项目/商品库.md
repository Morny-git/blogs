商品库的包含的几大模块

- 创建商品feed

- feed 解析

- 全量过期

  全量过期是针对自动上传中的全量商品进行diff，删除差集商品只保留最新商品的一个服务

  部署在less 和much的机器上

  - 遍历本机ID文件目录，文件格式{feKed}.{timestamp} 123.1536550256 以FEED_ID方式分组
  - 按照timestamp由低到高排序,产生结构，形如 Map<feed, List<ts1,ts2>
  - 循环Map, 读取Redis中当前存放的bloomfilter
  - 将文件中的id与该bloomfilter的ID做对比，文件的差集对比bloomfilter总量下降幅度是否超过30%（这个阈值根据文件配置）。，否则删除差集中的商品
  - 如果超过30%，则重命名有问题的ID文件并超过发送报警；如果不超过30%，则执行删除操作
  - 删除操作：查询库中是否有该数据，如果有，判断bid与文件{feed}是否一致，一致则删除

- 人工审核服务

  人工审核系统针对的是手动上传商品

  - 商品经过parser的解析后入库存储，并将商品信息发送到人工审核系统
  - 人工审核商品后将审核结果发送到kafka
  - 服务接收kafka消息，并将消息存储至redis的list队列中
  - 从list的队列中以阻塞的方式拿到审核信息，并将信息放入list2以作备份
  - 解析消息，查询商品，比较 审核信息中的version 与数据库中的version
  - 审核信息中的version低于商品库中，则为过期消息，丢弃。否则更新商品的审核状态
  - 删除list和list2中的审核消息。结束审核

- 存储分发

